<!DOCTYPE html>
<html lang="en" class="loginHtml" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta http-equiv="refresh" content="1200" charset="utf-8">
	<title th:text="#{title.login}">登录--沸石智能人脸识别系统</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="icon" href="/resources/favicon.ico">
	<link rel="stylesheet" href="/resources/layui/css/layui.css" media="all" />
	<link rel="stylesheet" href="/resources/css/public.css" media="all" />
</head>
<body class="loginBody" >
 
	<form class="layui-form">
		<div class="login_face"><img src="/resources/images/face.jpg" class="userAvatar"></div>
		<div class="layui-form-item input-item">
			<input id="loginLang" name="loginLang" th:value="${lang}" type="hidden">
			<label for="loginName" th:text="#{messages.loginName}">用户名</label>
			<input type="text" th:placeholder="#{messages.loginNamePH}" autocomplete="off" id="loginName" name="loginName" class="layui-input" lay-verify="required">
		</div>
		<div class="layui-form-item input-item">
			<label for="pwd" th:text="#{messages.pwd}">密码</label>
			<input type="password" th:placeholder="#{messages.pwdPH}" autocomplete="off" id="pwd" name="pwd" class="layui-input" lay-verify="required">
		</div>
		<div class="layui-form-item input-item" id="imgCode">
			<label for="code" th:text="#{messages.verifyCode}">验证码</label>
			<input type="text" th:placeholder="#{messages.codePH}" autocomplete="off" id="code" name="code" class="layui-input">
			<img id="img" th:src="@{/login/getCode}" onclick="this.src=this.src+'?'">
		</div>
		<div class="layui-form-item">
			<button class="layui-btn layui-block" lay-filter="login" th:text="#{messages.login}" lay-submit>登录</button>
		</div>
		<div class="layui-form-item layui-row" >
			 <a href="/sys/toRegister" class="grid-demo grid-demo-bg1 layui-col-md4 " style="color: white" th:text="#{messages.register}">立即注册</a>
			 <a href="/sys/toResetPassword" class="grid-demo layui-col-md4 layui-col-md-offset4"  style="color: white;text-align: right" th:text="#{messages.forgetpwd}">忘记密码？</a>
		</div>

		<div id="alert" style="display: none;padding-right: 3%">
		</div>
		
	</form>
	
	<div style="text-align: right;">
	      <a th:href="@{/sys/toLogin(lang='zh_CN')}" style="color: white;font-size:20px">中文版</a>
	      <font style="color: white;font-size:20px">|</font>
          <a th:href="@{/sys/toLogin(lang='en_US')}" style="color: white;font-size:20px">English</a>
	</div>
	<script type="text/javascript" src="/resources/layui/layui.js"></script>
	<script type="text/javascript" src="/resources/js/cache.js"></script>
	
	<script type="text/javascript">
	layui.use(['form','layer','jquery'],function(){
	    var form = layui.form,
	        layer = parent.layer === undefined ? layui.layer : top.layer
	        $ = layui.jquery;

		function open(){
			//示范一个公告层
			layer.open({
				type: 1
				,title: false //不显示标题栏
				,closeBtn: false
				,area: '300px;'
				,shade: 0.8
				,id: 'LAY_layuipro' //设定一个id，防止重复弹出
				,btn: ['确定']
				,btnAlign: 'c'
				,moveType: 1 //拖拽模式，0或者1
				,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">您的登录已过期，请重新登录！</div>'
				,success: function(layero){
					// var btn = layero.find('.layui-layer-btn');
					// btn.find('.layui-layer-btn0').attr({
					// 	href: 'http://www.layui.com/'
					// 	,target: '_blank'
					// });
					// $("#LAY_layuipro").innerText=""
				}
			});
		};

		if(localStorage.getItem("timesup")!=null){
			localStorage.removeItem("timesup")
			open()

		};

	    var src ="/login/getCode";

	    //登录按钮
	    form.on("submit(login)",function(data){
            var btn =  $(this);
            //设置登录按钮  为不可点击
            btn.text("登录中...").attr("disabled","disabled").addClass("layui-disabled");
            $.post("/login/login",data.field,function(rs){
                //设置登录按钮 恢复可点击   在前端防止 重复点击
                btn.text("登录").attr("disabled",false).removeClass("layui-disabled");
                layer.msg(rs.msg);
                if(rs.code != 200){
                    layer.msg(rs.msg);
                    $.get("/login/getCode",function (code) {
						console.log("refresh")
						src+="?"
                        $("#img").attr("src",src);
                    })
                }else{
                    //跳转到templates/system/index/index.html页面
                    layer.msg(rs.msg);
                    location.href="/sys/select";
                }
            });
	        return false;
	    });

	    //表单输入效果
	    $(".loginBody .input-item").click(function(e){
	        e.stopPropagation();
	        $(this).addClass("layui-input-focus").find(".layui-input").focus();
	    });
	    $(".loginBody .layui-form-item .layui-input").focus(function(){
	        $(this).parent().addClass("layui-input-focus");
	    });
	    $(".loginBody .layui-form-item .layui-input").blur(function(){
	        $(this).parent().removeClass("layui-input-focus");
	        if($(this).val() != ''){
	            $(this).parent().addClass("layui-input-active");
	        }else{
	            $(this).parent().removeClass("layui-input-active");
	        }
	    });


		function autoRefresh(seconds){
			if(typeof period == "undefined"){   //如果是第一次执行
				period = seconds * 1000;    //定义全局变量period
				// var bodyDOM = document.getElementsByTagName("body")[0];
				// if(bodyDOM){
				// 	bodyDOM.innerHTML += '<img id="auto_refresh_img" src="" style="display:none" />';   //添加隐藏的图片
				// 	imgDOM = document.getElementById("auto_refresh_img");   //定义全局Image对象
				// }
			}
			if(typeof imgDOM != "undefined"){
				imgDOM.src = "ping.php?sid=" + new Date().getTime();    //防止缓存
				setTimeout("autoRefresh(" + seconds + ")", period);
			}
		};
		autoRefresh(600);   //调用方法启动定时刷新
	})

	</script>
</body>
</html>